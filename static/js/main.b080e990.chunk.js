(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,n,t){e.exports=t(33)},27:function(e,n,t){},32:function(e,n,t){},33:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(19),i=t.n(o),c=t(9),l={regions:[{name:"us-east",azs:["a","b","c"].map(function(e,n){return{name:e,nodes:[{id:n+1}]}})}]},s={regions:["us-west","us-central","us-east"].map(function(e,n){return{name:e,azs:["a","b","c"].map(function(e,t){return{name:e,nodes:[{id:3*n+t+1}]}})}})},u={name:"users",indexes:[{name:"primary",partitions:[{name:"default"}]}]},d={name:"postal_codes",indexes:["us-west","us-central","us-east"].map(function(e){return{name:e,zoneConfig:{dataRegion:null,leaseholdersRegion:e},partitions:[{name:"default"}]}})},m=t(11),f=t(7);function p(e,n,t){var a=function(e){return e.partition.zoneConfig?e.partition.zoneConfig:e.index.zoneConfig}(n);return void 0===a?g(t,e,!1):a.dataRegion===e.regionName?g(t,e,!1):null!==a.leaseholdersRegion?g(t,e,a.leaseholdersRegion===e.regionName):{type:"NoData"}}function g(e,n,t){return function(e,n){return-1!==e.indexOf(n.nodeID)}(e,n)?{type:"WouldHaveDataButDown",pinnedLeaseholders:t}:{type:"Data",pinnedLeaseholders:t}}function h(e){return e.reduce(function(e,n){return Math.max(e,n)},0)}function N(e){return{type:"Parallel",children:e}}function w(e,n){return{type:"Leaf",desc:e,duration:n}}function E(e,n,t){return{type:"RPC",desc:n,remoteTrace:{nodePath:e,process:t}}}function v(e){return e.regions.reduce(function(e,n){return e+D(n)},0)}function D(e){return e.azs.reduce(function(e,n){return e+y(n)},0)}function b(e){return e.azs.flatMap(function(e){return e.nodes})}function y(e){return e.nodes.length}function I(e){return e.regions.flatMap(x)}function x(e){return e.azs.flatMap(function(n){return function(e,n){return n.nodes.map(function(t){return{regionName:e,azName:n.name,nodeID:t.id}})}(e.name,n)})}function P(e){return e.indexes.reduce(function(e,n){return e+T(n)},0)}function T(e){return e.partitions.length}function O(e,n){var t=function(e,n){return I(n.config.formation).filter(function(t){return"Data"===p(t,e,n.downNodeIDs).type})}(e,n).length,a=v(n.config.formation),r=Math.min(a,Math.ceil(1.5));return t>=3?"OK":t<r?"Unavailable":"Underreplicated"}function R(e,n){var t=function(e,n){var t=[];return e.forEach(function(e){-1!==n.indexOf(e)&&t.push(e)}),t}(e,n);return 0===t.length?"OK":t.length===e.length?"FullyDown":"PartiallyDown"}var z=t(5),C=t.n(z);function k(e){var n=e.config.table;return a.createElement("table",{className:"config-view"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("td",null),a.createElement("td",{className:"schema-level-label"},"Table"),a.createElement("td",{className:"schema-level-label"},"Index"),a.createElement("td",{className:"schema-level-label"},"Partition"),a.createElement("td",{colSpan:v(e.config.formation)})),a.createElement("tr",null,a.createElement("th",{className:"formation-level-label"},"Region"),a.createElement("th",{colSpan:3}),e.config.formation.regions.map(function(n){var t,r,o=(t=n,r=e.downNodeIDs,R(b(t).map(function(e){return e.id}),r));return a.createElement("th",{key:n.name,colSpan:D(n),className:W(o),onClick:function(){H(o,e.downNodeIDs,b(n).map(function(e){return e.id}),e.setDownNodeIDs)}},n.name)})),a.createElement("tr",null,a.createElement("th",{className:"formation-level-label"},"AZ"),a.createElement("th",{colSpan:3}),e.config.formation.regions.map(function(n){return n.azs.map(function(n){var t=function(e,n){return R(e.nodes.map(function(e){return e.id}),n)}(n,e.downNodeIDs);return a.createElement("th",{key:n.name,colSpan:y(n),className:W(t),onClick:function(){H(t,e.downNodeIDs,n.nodes.map(function(e){return e.id}),e.setDownNodeIDs)}},n.name)})})),a.createElement("tr",null,a.createElement("th",{className:"formation-level-label"},"Node"),a.createElement("td",{colSpan:3}),e.config.formation.regions.map(function(n){return n.azs.map(function(n){return n.nodes.map(function(n){return a.createElement("th",{key:n.id,onClick:function(){return function(e,n,t){var a=function(e,n){var t=e.indexOf(n);if(-1===t)return[].concat(Object(f.a)(e),[n]);return function(e,n){var t=[];return e.forEach(function(e,a){a!==n&&t.push(e)}),t}(e,t)}(e,n);t(a)}(e.downNodeIDs,n.id,e.setDownNodeIDs)},className:C()("formation-node","formation-node-leaf",{"formation-node-fully-down":-1!==e.downNodeIDs.indexOf(n.id)})},"n",n.id)})})}))),a.createElement("tbody",null,n.indexes.map(function(t,r){return t.partitions.map(function(o,i){var c={table:e.config.table,index:t,partition:o},l=O(c,{config:e.config,downNodeIDs:e.downNodeIDs});return a.createElement("tr",{key:"".concat(t.name,"/").concat(o.name)},a.createElement("td",null),0===r&&0===i?a.createElement("td",{className:C()("schema-node"),rowSpan:P(n)},S(n.name,n.zoneConfig)):null,0===i?a.createElement("td",{className:C()("schema-node"),rowSpan:T(t)},S(t.name,t.zoneConfig)):null,a.createElement("td",{className:C()("schema-node","schema-node-leaf",{"schema-node-underreplicated":"Underreplicated"===l,"schema-node-unavailable":"Unavailable"===l})},S(o.name,o.zoneConfig)),I(e.config.formation).map(function(n){return function(e,n,t){var r=(l=e,"".concat(l.regionName,"/").concat(l.azName,"/").concat(l.azName)),o=p(e,n,t),i=function(e,n,t){var a="Data"===t.type?"is present":"NoData"===t.type?"is not present":"would be present if the node were not down",r="Data"===t.type&&t.pinnedLeaseholders?"Leaseholders have been pinned to this region.":"";return'Data for partition "'.concat(e.partition.name,'" of index "').concat(e.index.name,'" of table "').concat(e.table.name,'" ').concat(a," on node ").concat(n.nodeID," in AZ ").concat(n.azName," of region ").concat(n.regionName,". ").concat(r)}(n,e,o),c=function(){switch(o.type){case"Data":return"cell cell-data";case"NoData":return"cell cell-no-data";case"WouldHaveDataButDown":return"cell cell-data-but-down"}}();var l;return a.createElement("td",{key:r,title:i,className:c},"Data"===o.type&&o.pinnedLeaseholders?"LH":"")}(n,c,e.downNodeIDs)}))})})))}function S(e,n){var t=void 0===n?"":function(e){if(e.leaseholdersRegion)return"zone config pinning leaseholders to region ".concat(e.leaseholdersRegion);if(e.dataRegion)return"zone config pinning data to region ".concat(e.dataRegion);return""}(n);return a.createElement("span",{title:t},e,void 0===n?"":"*")}function W(e){return C()("formation-node",{"formation-node-partially-down":"PartiallyDown"===e,"formation-node-fully-down":"FullyDown"===e})}function H(e,n,t,a){a("OK"===e?function(e,n){var t=[];return e.forEach(function(e){t.push(e)}),n.forEach(function(n){-1===e.indexOf(n)&&t.push(n)}),t}(n,t):function(e,n){var t=[];return e.forEach(function(e){-1===n.indexOf(e)&&t.push(e)}),t}(n,t))}function j(e,n){var t,a,r,o,i=(t=e.config.table,a=n,t.indexes.map(function(e){return{tableName:t.name,indexName:e.name,partitionName:a.partitionName}})),c=(r=e.config.formation,o=n.gateWayNodeID,I(r).find(function(e){return e.nodeID===o}));if(!c)throw new Error("gateway node not found");return{nodePath:c,process:N(i.map(function(n){var t=function(e,n){var t=function(e,n){var t=[];return e.forEach(function(e){var a=n(e);null!==a&&t.push(a)}),t}(I(e.config.formation),function(t){var a=function(e,n){var t=e.indexes.find(function(e){return e.name===n.indexName});if(!t)throw new Error("index not found");var a=t.partitions.find(function(e){return e.name===n.partitionName});if(!a)throw new Error('partition "'.concat(n.partitionName,'" not found in [').concat(t.partitions.map(function(e){return'"'.concat(e.name,'"')}).join(", "),"]"));return{table:e,index:t,partition:a}}(e.config.table,n),r=p(t,a,e.downNodeIDs);return"NoData"===r.type?null:{nodePath:t,leaseholdersPinned:r.pinnedLeaseholders}});return(t.some(function(e){return e.leaseholdersPinned})?t.filter(function(e){return e.leaseholdersPinned}):t).map(function(e){return e.nodePath})}(e,n),a=t[0],r=t.slice(1,3);return E(a,"request leaseholder to write to index ".concat(n.indexName,", partition ").concat(n.partitionName),N([w("write data",1)].concat(Object(f.a)(r.map(function(e){return E(e,"replicate data to follower",w("write data",1))})))))}))}}var L=30,M=20,F=30;function J(e){var n=h(e.sequence.map(function(e){return A(e.end)})),t=A(n);return a.createElement("div",{className:"hop-seq"},a.createElement("svg",{height:t},a.createElement("g",null,I(e.formation).map(function(n){var r=q(n.nodeID);return a.createElement("g",{key:n.nodeID},a.createElement("text",{className:"node-label",x:r-10,y:20,onClick:function(){return e.setWrite(Object(m.a)({},e.write,{gateWayNodeID:n.nodeID}))}},"n",n.nodeID),a.createElement("line",{className:"node-line",x1:r,x2:r,y1:F,y2:t}))})),a.createElement("g",null,e.sequence.map(function(n,t){return a.createElement("line",{key:t,className:C()("hop-line",{"hop-line-cross-region":n.from.regionName!==n.to.regionName,"hop-line-hovered":JSON.stringify(n.traceNode)===JSON.stringify(e.highlightedTrace)}),onMouseOver:function(){return e.setHighlightedTrace(n.traceNode)},onMouseOut:function(){return e.setHighlightedTrace(void 0)},x1:q(n.from.nodeID),x2:q(n.to.nodeID),y1:A(n.start),y2:A(n.end)})}))))}function q(e){return e*L+M}function A(e){return F+e}function B(e){return function e(n,t){var a=t.process;var r=t.nodePath;switch(a.type){case"Parallel":return a.children.flatMap(function(t){return e(n,{nodePath:r,process:t})});case"RPC":var o=function(e,n){if(e.regionName===n.regionName)return 10;return 100}(r,a.remoteTrace.nodePath),i=a.remoteTrace.nodePath,c=e(n+o,{nodePath:i,process:a.remoteTrace.process}),l=h(c.map(function(e){return e.end}));return[{from:r,to:i,start:n,end:n+o,traceNode:t}].concat(Object(f.a)(c),[{from:i,to:r,start:l,end:l+o,traceNode:t}]);case"Leaf":return[{from:r,to:r,start:n,end:n+a.duration,traceNode:t}]}}(0,e)}function U(e){return r.a.createElement("ul",{className:"trace-view"},r.a.createElement("li",{className:C()("trace-node",{"trace-node-highlighted":JSON.stringify(e.highlightedTrace)===JSON.stringify(e.trace)}),onMouseEnter:function(){return e.setHighlightedTrace(e.trace)},onMouseLeave:function(){return e.setHighlightedTrace(void 0)}},"On n",e.trace.nodePath.nodeID,":"," ",r.a.createElement(K,{process:e.trace.process,highlightedTrace:e.highlightedTrace,setHighlightedTrace:e.setHighlightedTrace})))}function K(e){switch(e.process.type){case"Leaf":return r.a.createElement(r.a.Fragment,null,e.process.desc);case"Parallel":return r.a.createElement(r.a.Fragment,null,"In parallel:",r.a.createElement("ul",null,e.process.children.map(function(n,t){return r.a.createElement("li",{key:t},r.a.createElement(K,{process:n,setHighlightedTrace:e.setHighlightedTrace,highlightedTrace:e.highlightedTrace}))})));case"RPC":return r.a.createElement(r.a.Fragment,null,"call n",e.process.remoteTrace.nodePath.nodeID," to"," ",e.process.desc,r.a.createElement(U,{trace:e.process.remoteTrace,setHighlightedTrace:e.setHighlightedTrace,highlightedTrace:e.highlightedTrace}))}}function _(e){var n=Object(a.useState)(e.situation.downNodeIDs),t=Object(c.a)(n,2),r=t[0],o=t[1];return a.createElement(a.Fragment,null,a.createElement(k,{config:e.situation.config,downNodeIDs:r,setDownNodeIDs:o}),e.writes.length>0&&a.createElement(a.Fragment,null,a.createElement("h4",null,"Simulated Writes"),e.writes.map(function(n,t){return a.createElement(G,{key:t,situation:e.situation,write:n})})))}function G(e){var n=Object(a.useState)(e.write.write),t=Object(c.a)(n,2),r=t[0],o=t[1],i=Object(a.useState)(),l=Object(c.a)(i,2),s=l[0],u=l[1],d=function e(n){switch(n.process.type){case"RPC":return n.nodePath.nodeID===n.process.remoteTrace.nodePath.nodeID?e(n.process.remoteTrace):n;case"Parallel":return 1===n.process.children.length?{nodePath:n.nodePath,process:n.process.children[0]}:n;default:return n}}(j(e.situation,r)),m=B(d);return a.createElement(a.Fragment,null,a.createElement("h5",null,e.write.desc),a.createElement(Z,{write:r,setWrite:o,config:e.situation.config}),a.createElement(J,{formation:e.situation.config.formation,sequence:m,write:r,setWrite:o,highlightedTrace:s,setHighlightedTrace:u}),a.createElement(U,{trace:d,highlightedTrace:s,setHighlightedTrace:u}))}function Z(e){var n=e.write,t=e.config.table.indexes[0].partitions.map(function(e){return e.name});return a.createElement("p",null,"Write from node ",a.createElement("strong",null,"n",e.write.gateWayNodeID)," to table"," ",a.createElement("strong",null,n.tableName),", partition"," ",a.createElement("select",{value:n.partitionName,onChange:function(n){return e.setWrite(Object(m.a)({},e.write,{partitionName:n.target.value}))}},t.map(function(e){return a.createElement("option",null,e)})),":")}var Q=t(12),V=t(6),X=(t(27),{id:"development",name:"Development",situation:{config:{formation:{regions:[{name:"laptop",azs:[{name:"N/A",nodes:[{id:1}]}]}]},table:u},downNodeIDs:[]},writes:[{desc:"simple write",write:{gateWayNodeID:1,tableName:"users",partitionName:"default"}}]}),Y={id:"basic-production",name:"Basic Production",situation:{config:{formation:l,table:u},downNodeIDs:[]},writes:[{desc:"",write:{gateWayNodeID:1,tableName:"users",partitionName:"default"}}]},$={id:"naive-multiregion",name:"Naive Multiregion",situation:{config:{formation:s,table:u},downNodeIDs:[]},writes:[{desc:"local write (lucky!)",write:{tableName:"users",partitionName:"default",gateWayNodeID:3}},{desc:"non-local write (bad!)",write:{tableName:"users",partitionName:"default",gateWayNodeID:4}}]},ee={id:"geo-partitioned-replicas",name:"Geo-Partitioned Replicas",situation:{config:{formation:s,table:{name:"users",indexes:[{name:"primary",partitions:[{name:"west",zoneConfig:{leaseholdersRegion:null,dataRegion:"us-west"}},{name:"central",zoneConfig:{leaseholdersRegion:null,dataRegion:"us-central"}},{name:"east",zoneConfig:{leaseholdersRegion:null,dataRegion:"us-east"}}]}]}},downNodeIDs:[2,3]},writes:[{desc:"Local, partitioned write (good!)",write:{gateWayNodeID:2,tableName:"users",partitionName:"west"}}]},ne={id:"geo-partitioned-leaseholders",name:"Geo-Partitioned Leaseholders",situation:{config:{formation:s,table:{name:"users",indexes:[{name:"primary",partitions:[{name:"west",zoneConfig:{leaseholdersRegion:"us-west",dataRegion:null}},{name:"central",zoneConfig:{leaseholdersRegion:"us-central",dataRegion:null}},{name:"east",zoneConfig:{leaseholdersRegion:"us-east",dataRegion:null}}]}]}},downNodeIDs:[]},writes:[{desc:"",write:{partitionName:"west",tableName:"postal_codes",gateWayNodeID:2}}]},te={id:"duplicate-indexes",name:"Duplicate Indexes",situation:{config:{formation:s,table:d},downNodeIDs:[]},writes:[{desc:"",write:{partitionName:"default",tableName:"postal_codes",gateWayNodeID:2}}]};function ae(){return r.a.createElement("div",{className:"container"},r.a.createElement("h1",null,"Topology Patterns Illustration"),r.a.createElement("p",null,"An alternative illustration of the patterns documented here:"," ",r.a.createElement("a",{href:"https://www.cockroachlabs.com/docs/stable/topology-patterns.html"},"Topology Patterns"),"."),r.a.createElement("h2",null,"Single-Region Patterns"),r.a.createElement(re,{pattern:X}),r.a.createElement(re,{pattern:Y}),r.a.createElement("h2",null,"Multi-Region Patterns"),r.a.createElement("p",null,"These patterns involve a cluster with servers in multiple regions."),r.a.createElement(re,{pattern:$}),r.a.createElement(re,{pattern:ee}),r.a.createElement(re,{pattern:ne}),r.a.createElement(re,{pattern:te}))}function re(e){var n=Object(a.useState)([]),t=Object(c.a)(n,2),o=t[0],i=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,r.a.createElement(Q.b,{to:e.pattern.id},e.pattern.name)),r.a.createElement(k,{config:e.pattern.situation.config,downNodeIDs:o,setDownNodeIDs:i}))}function oe(e){return r.a.createElement("div",{className:"container"},r.a.createElement("p",null,r.a.createElement(Q.b,{to:"/"},"< Patterns")),r.a.createElement("h1",null,e.pattern.name),r.a.createElement(_,{situation:e.pattern.situation,writes:e.pattern.writes}))}var ie=[X,Y,$,ee,ne,te];var ce=function(){return r.a.createElement(Q.a,null,r.a.createElement(V.a,{path:"/",component:ae,exact:!0}),ie.map(function(e){return r.a.createElement(V.a,{key:e.id,path:"/".concat(e.id),component:function(){return r.a.createElement(oe,{pattern:e})}})}))};t(32);i.a.render(r.a.createElement(ce,null),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.b080e990.chunk.js.map